<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kuis Anak Ngaji</title>

<style>
body {
  font-family: "Comic Sans MS", Arial, sans-serif;
  background: linear-gradient(135deg, #84fab0, #8fd3f4);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.card {
  background: #fff;
  width: 90%;
  max-width: 700px;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  text-align: center;
}
button {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  cursor: pointer;
  background: #4facfe;
  color: white;
}
.feedback-correct { color: green; font-weight: bold; }
.feedback-incorrect { color: red; font-weight: bold; }
.progress-bar {
  width: 100%;
  height: 25px;
  background: #e0e0e0;
  border-radius: 10px;
  overflow: hidden;
  margin: 10px 0;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #4facfe, #00f2fe);
  width: 0%;
  transition: width 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 12px;
  font-weight: bold;
}

/* RESPONSIVE DESIGN */
@media (max-width: 768px) {
  body {
    padding: 10px;
  }
  
  .card {
    width: 100%;
    max-width: 100%;
    padding: 20px;
    border-radius: 15px;
  }
  
  h1 {
    font-size: 20px;
    margin-bottom: 15px;
  }
  
  h2 {
    font-size: 18px;
  }
  
  button {
    padding: 10px;
    font-size: 14px;
    margin: 6px 0;
  }
  
  #playerName {
    font-size: 16px;
  }
  
  p {
    font-size: 14px;
  }
  
  #question {
    font-size: 16px;
    margin: 15px 0;
  }
}

@media (max-width: 480px) {
  body {
    padding: 8px;
  }
  
  .card {
    padding: 15px;
    border-radius: 12px;
  }
  
  h1 {
    font-size: 18px;
    margin-bottom: 12px;
  }
  
  h2 {
    font-size: 16px;
  }
  
  button {
    padding: 10px;
    font-size: 13px;
    margin: 5px 0;
  }
  
  #playerName {
    font-size: 14px;
    padding: 8px;
  }
  
  p {
    font-size: 13px;
  }
  
  #question {
    font-size: 15px;
    margin: 12px 0;
  }
  
  .progress-bar {
    height: 20px;
    margin: 8px 0;
  }
  
  .progress-fill {
    font-size: 10px;
  }
}

@media (max-width: 360px) {
  .card {
    padding: 12px;
  }
  
  h1 {
    font-size: 16px;
  }
  
  button {
    padding: 8px;
    font-size: 12px;
  }
  
  #playerName {
    font-size: 13px;
    padding: 6px;
  }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

.hurufJatuh {
  position: absolute;
  left: calc(10% + 80% * var(--rand));
  top: 0;
  font-size: 50px;
  cursor: pointer;
  padding: 15px 25px;
  background: white;
  border-radius: 20px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  transition: transform 0.2s;
  user-select: none;
  font-weight: bold;
  border: 3px solid #4facfe;
}

.hurufJatuh:hover {
  transform: scale(1.15);
  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}

.hurufJatuh.correct {
  background: #4caf50;
  color: white;
  animation: pulse 0.5s;
}

.hurufJatuh.target {
  border: 4px solid #ff6b6b;
  background: linear-gradient(135deg, #ffe082, #ff9800);
  font-weight: bold;
}
</style>
</head>

<body>

<div class="card">

<!-- START SCREEN -->
<div id="startScreen">
  <h1>üïå Kuis Pengetahuan Mengaji Masjid Roisiyah üïå</h1>
  <input type="text" id="playerName" placeholder="Masukkan Nama" style="padding:10px;width:100%;margin-bottom:10px">
  <button onclick="startQuiz()">üöÄ Mulai Kuis</button>
</div>

<!-- MINI GAME SCREEN -->
<div id="miniGameScreen" style="display:none;">
  <h2>üéÆ Mini Game: Tangkap Huruf!</h2>
  <p>Klik huruf yang diminta sebelum waktu habis!</p>
  <div style="background: linear-gradient(135deg, #fff5e1, #ffe6cc); padding: 15px; border-radius: 10px; margin: 15px 0; border: 3px solid #ff9800;">
    <p style="margin: 5px 0; font-size: 14px;">üìå Target Huruf:</p>
    <h1 id="targetHuruf" style="font-size: 60px; margin: 10px 0; color: #ff6b6b; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);"></h1>
  </div>
  <div style="display: flex; justify-content: space-around; margin: 10px 0; background: #f0f0f0; padding: 10px; border-radius: 10px;">
    <div><p style="margin: 5px 0; font-size: 14px;">‚è≥ Waktu: <span id="gameTime" style="font-weight: bold; color: #ff6b6b;">20</span> detik</p></div>
    <div><p style="margin: 5px 0; font-size: 14px;">‚≠ê Skor: <span id="miniScore" style="font-weight: bold; color: #4facfe;">0</span></p></div>
  </div>
  <div id="gameArea" style="position:relative;height:450px;background:linear-gradient(135deg, #e3f2fd, #f3e5f5);border-radius:15px;overflow:hidden;margin:10px 0;border:3px dashed #9c27b0;box-shadow:inset 0 0 10px rgba(0,0,0,0.1);"></div>
</div>

<!-- QUIZ SCREEN -->
<div id="quizScreen" style="display:none;">
  <p id="question" style="font-size:18px;font-weight:500;margin:20px 0;"></p>

  <button id="o0" onclick="answer(0)" style="background:linear-gradient(135deg, #667eea, #764ba2);"></button>
  <button id="o1" onclick="answer(1)" style="background:linear-gradient(135deg, #f093fb, #f5576c);"></button>
  <button id="o2" onclick="answer(2)" style="background:linear-gradient(135deg, #4facfe, #00f2fe);"></button>
  <button id="o3" onclick="answer(3)" style="background:linear-gradient(135deg, #43e97b, #38f9d7);"></button>

  <p id="feedback" style="font-size:18px;margin:20px 0;min-height:30px;"></p>
</div>

<!-- GAME OVER SCREEN -->
<div id="gameOverScreen" style="display:none;">
  <h2 style="color:#ff6b6b;">üíÄ GAME OVER</h2>
  <p id="gameOverPlayerName" style="font-size:18px;margin-bottom:20px;"></p>
  <div style="background:#ffe6e6;padding:20px;border-radius:10px;margin-bottom:15px;border-left:5px solid #ff6b6b;">
    <p style="margin:10px 0;font-size:16px;">Anda telah melakukan <span style="font-weight:bold;">5 kesalahan</span></p>
    <p style="margin:10px 0;font-size:16px;">Soal dijawab: <span id="gameOverQuestions" style="font-weight:bold;"></span></p>
    <p style="margin:10px 0;font-size:16px;">üìä Point Terkumpul: <span id="gameOverPoint" style="font-weight:bold;color:#4facfe;"></span></p>
  </div>
  <p style="font-size:14px;margin-bottom:20px;color:#666;">Coba lagi untuk mendapatkan skor yang lebih baik!</p>
  <button onclick="location.reload()">üîÑ Main Lagi</button>
</div>

<!-- RESULT SCREEN -->
<div id="resultScreen" style="display:none;">
  <h2>Hasil Akhir</h2>
  <p id="playerNameDisplay" style="font-size:18px;margin-bottom:20px;"></p>
  <div style="background:#f0f0f0;padding:15px;border-radius:10px;margin-bottom:15px;">
    <p style="margin:5px 0;font-size:16px;">‚≠ê Point: <span id="finalPoint" style="font-weight:bold;color:#4facfe;"></span></p>
    <p style="margin:5px 0;font-size:16px;">üìä Nilai: <span id="finalScore" style="font-weight:bold;color:#4facfe;"></span>%</p>
  </div>
  <p id="rankMessage" style="font-size:16px;margin-bottom:20px;"></p>
  <button onclick="location.reload()">üîÑ Main Lagi</button>
</div>

</div>

<script>
const GOOGLE_APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwn0JLkBQkS3O_WYhY6bfz_IdIXGQoEXJr68ciGcwM_S947L_r0cHa94rDns_Jdl7h8Fw/exec";

const soalBank = [
  // HUKUM NUN SUKUN DAN TANWIN 
  { q:"Hukum nun sukun bertemu ÿ´ adalah?", o:["Idhgham","Ikhfa","Iqlab","Idzhar"], a:1 },
  { q:"Hukum nun sukun bertemu ÿ¨ adalah?", o:["Idhgham","Ikhfa","Iqlab","Idzhar"], a:1 },
  { q:"Hukum nun sukun bertemu ÿØ adalah?", o:["Idhgham","Ikhfa","Iqlab","Idzhar"], a:0 },
  { q:"Hukum nun sukun bertemu ŸÑ adalah?", o:["Idhgham","Ikhfa","Iqlab","Idzhar"], a:0 },
  { q:"Tanwin bertemu ÿ® hukumnya adalah?", o:["Idhgham","Ikhfa","Iqlab","Idzhar"], a:2 },
  { q:"Tanwin bertemu ÿ¨ hukumnya adalah?", o:["Idhgham","Ikhfa","Iqlab","Idzhar"], a:1 },
  { q:"Tanwin dengan ghunnah terjadi pada?", o:["Semua huruf","Beberapa huruf","Hanya 4 huruf","Tidak ada"], a:1 },
  
  // HUKUM MIM SUKUN
  { q:"Hukum mim sukun bertemu ÿ® adalah?", o:["Idhgham Mimi","Ikhfa Syafawi","Idzhar Syafawi","Iqlab"], a:0 },
  { q:"Hukum mim sukun bertemu ŸÅ adalah?", o:["Idhgham Mimi","Ikhfa Syafawi","Idzhar Syafawi","Iqlab"], a:1 },
  
  // GHUNNAH MUSYADDADAH 
  { q:"Ghunnah Musyaddadah terjadi pada huruf?", o:["Nun bertasydid","Mim bertasydid","Keduanya","Tidak keduanya"], a:2 },
  { q:"Panjang Ghunnah Musyaddadah adalah?", o:["1 harakat","2 harakat","3 harakat","4 harakat"], a:1 },
  
  // RUKUN IMAN (6 soal)
  { q:"Rukun Iman ada berapa?", o:["4","5","6","7"], a:2 },
  { q:"Percaya kepada Allah adalah rukun iman yang ke?", o:["Pertama","Kedua","Ketiga","Keempat"], a:0 },
  { q:"Rukun Iman yang kedua adalah?", o:["Percaya kepada Malaikat","Percaya kepada Kitab","Percaya kepada Nabi","Percaya kepada Qada dan Qadar"], a:0 },
  { q:"Rukun Iman yang ketiga adalah?", o:["Percaya kepada Malaikat","Percaya kepada Kitab Suci","Percaya kepada Nabi","Percaya kepada Qada dan Qadar"], a:1 },
  { q:"Percaya kepada Nabi dan Rasul adalah rukun iman yang ke?", o:["Ketiga","Keempat","Kelima","Keenam"], a:1 },
  { q:"Rukun Iman yang terakhir adalah?", o:["Percaya kepada Malaikat","Percaya kepada Kitab","Percaya kepada Hari Akhir","Percaya kepada Qada dan Qadar"], a:3 },
  
  // RUKUN ISLAM (5 soal)
  { q:"Rukun Islam ada berapa?", o:["3","4","5","6"], a:2 },
  { q:"Rukun Islam yang pertama adalah?", o:["Shalat","Syahadat","Zakat","Haji"], a:1 },
  { q:"Rukun Islam yang kedua adalah?", o:["Syahadat","Shalat Lima Waktu","Zakat","Puasa"], a:1 },
  { q:"Zakat adalah rukun islam yang ke?", o:["Kedua","Ketiga","Keempat","Kelima"], a:2 },
  { q:"Haji adalah rukun islam yang ke?", o:["Ketiga","Keempat","Kelima","Keenam"], a:2 },
  
  // CERITA NABI 
  { q:"Nabi Ibrahim dipanggil sebagai?", o:["Khalil Allah","Amir Al-Mu'minin","Rasul Allah","Nabi Terbaik"], a:0 },
  { q:"Nabi Musa menerima kitab berupa?", o:["Qur'an","Taurat","Injil","Zabur"], a:1 },
  { q:"Mukjizat Nabi Isa yang terkenal adalah?", o:["Tongkat","Menghidupkan yang mati","Loh Mahfuzh","Cahaya bulan"], a:1 },
  { q:"Nabi Daud menerima kitab berupa?", o:["Qur'an","Taurat","Zabur","Injil"], a:2 },
  
  // 4 SAHABAT UTAMA NABI (6 soal)
  { q:"Sahabat utama Nabi yang pertama adalah?", o:["Umar","Uthman","Abu Bakar","Ali"], a:2 },
  { q:"Gelar Abu Bakar adalah?", o:["Al-Faruq","Ash-Shiddiq","Dhul-Nuraini","Asadullah"], a:1 },
  { q:"Gelar Umar bin Khattab adalah?", o:["Ash-Shiddiq","Al-Faruq","Dhul-Nuraini","Asadullah"], a:1 },
  { q:"Gelar Uthman bin Affan adalah?", o:["Ash-Shiddiq","Al-Faruq","Dhul-Nuraini","Al-Ghani"], a:2 },
  { q:"Gelar Ali bin Abi Talib adalah?", o:["Ash-Shiddiq","Al-Faruq","Asadullah","Dhul-Nuraini"], a:2 },
  { q:"Khalifah pertama setelah Nabi Muhammad adalah?", o:["Umar","Uthman","Abu Bakar","Ali"], a:2 },
  
  // DOA SEHARI-HARI (10 soal)
  { q:"Doa sebelum makan adalah?", o:["bismika","Allahumma bariklana","Ghufronak","Subhanallah"], a:1 },
  { q:"Doa sesudah makan adalah?", o:["Alhamdulillah","Bismillah","Subhanallah","Astaghfirullah"], a:0 },
  { q:"Doa masuk rumah dimulai dengan?", o:["Assalamualaikum","Bismillah Allahu Akbar","Alhamdulillah","Subhanallah"], a:1 },
  { q:"Doa keluar rumah dimulai dengan?", o:["Assalamualaikum","Bismillah Allahu Akbar","Alhamdulillah","Subhanallah"], a:1 },
  { q:"Doa bangun tidur adalah?", o:["Subhanallah","Alhamdulillah","Astaghfirullah","Bismillah"], a:1 },
  { q:"Doa sebelum tidur adalah?", o:["Assalamualaikum","Astaghfirullah","Alhamdulillah wa syukran","Subhanallah wa bihamdihi"], a:3 },
  { q:"Doa sebelum belajar dimulai dengan?", o:["Bismillah","Assalamualaikum","Alhamdulillah","Subhanallah"], a:0 },
  { q:"Doa saat melihat sesuatu yang indah adalah?", o:["Mashallah","Alhamdulillah","Subhanallah","Astaghfirullah"], a:0 },
  { q:"Doa saat bersin dimulai dengan?", o:["Alhamdulillah","Bismillah","Subhanallah","Assalamualaikum"], a:0 },
  { q:"Doa mendengar panggilan adzan adalah?", o:["Takbir","Tahlil","Repeating the adzan words","Shalawat"], a:2 },
  
];

let soal = [];
let i = 0;
let point = 0;
let playerName = "";

/* ================= START QUIZ ================= */
function startQuiz() {
  playerName = document.getElementById("playerName").value.trim();
  if (!playerName) {
    alert("Masukkan nama terlebih dahulu");
    return;
  }

  document.getElementById("startScreen").style.display = "none";
  document.getElementById("miniGameScreen").style.display = "block";
  startMiniGame();
}

/* ================= LOAD SOAL ================= */
function loadSoal() {
  const buttons = document.querySelectorAll("#quizScreen button");

  document.getElementById("question").innerText = soal[i].q;
  document.getElementById("feedback").innerText = "";

  buttons.forEach((btn, x) => {
    btn.innerText = soal[i].o[x];
    btn.disabled = false;
  });
}

/* ================= JAWAB ================= */
function answer(pilih) {
  const buttons = document.querySelectorAll("#quizScreen button");
  buttons.forEach(btn => btn.disabled = true);

  if (pilih === soal[i].a) {
    point += 10;
  }

  setTimeout(() => {
    i++;
    if (i >= soal.length) {
      selesai();
    } else {
      loadSoal();
    }
  }, 400);
}

/* ================= SELESAI QUIZ ================= */
function selesai() {
  const nilai = Math.round((point / (soal.length * 10)) * 100);

  document.getElementById("quizScreen").style.display = "none";
  document.getElementById("resultScreen").style.display = "block";
  document.getElementById("playerNameDisplay").innerText = "üë§ " + playerName;
  document.getElementById("finalPoint").innerText = point;
  document.getElementById("finalScore").innerText = nilai;

  kirimKeSpreadsheet(playerName, point, nilai, "Selesai");
}

/* ================= KIRIM SPREADSHEET ================= */
function kirimKeSpreadsheet(nama, score, nilai, ranking) {
  const data = new URLSearchParams();
  data.append("nama", nama);
  data.append("score", score);
  data.append("nilai", nilai);
  data.append("peringkat", ranking);

  fetch(GOOGLE_APPS_SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    body: data
  });
}

/* ================= MINI GAME ================= */
let miniScore = 0;
let gameInterval;
let timeLeft = 20;
let target = "";
const huruf = ["ÿß","ÿ®","ÿ™","ÿ´","ÿ¨","ÿ≠","ÿÆ","ÿØ","ÿ∞","ÿ±","ÿ≤"];

function startMiniGame() {
  miniScore = 0;
  timeLeft = 20;

  document.getElementById("miniScore").innerText = miniScore;
  document.getElementById("gameTime").innerText = timeLeft;

  pilihTarget();

  gameInterval = setInterval(() => {
    timeLeft--;
    document.getElementById("gameTime").innerText = timeLeft;

    buatHurufJatuh();
    // Buat huruf lebih sering muncul
    setTimeout(() => buatHurufJatuh(), 300);

    if (timeLeft <= 0) {
      clearInterval(gameInterval);
      selesaiMiniGame();
    }
  }, 800);
}

function pilihTarget() {
  target = huruf[Math.floor(Math.random() * huruf.length)];
  document.getElementById("targetHuruf").innerText = target;
}

function buatHurufJatuh() {
  const gameArea = document.getElementById("gameArea");
  const el = document.createElement("div");
  // 60% target, 40% random
  const isTarget = Math.random() < 0.6;
  const displayHuruf = isTarget ? target : huruf[Math.floor(Math.random() * huruf.length)];

  el.innerText = displayHuruf;
  el.className = "hurufJatuh";
  el.style.left = Math.random() * 85 + 5 + "%";

  el.onclick = function(e) {
    e.stopPropagation();
    if (displayHuruf === target) {
      miniScore += 10;
      document.getElementById("miniScore").innerText = miniScore;
      el.classList.add("correct");
      el.style.pointerEvents = "none";
      setTimeout(() => el.remove(), 200);
      pilihTarget();
    } else {
      el.style.opacity = "0.3";
      el.style.pointerEvents = "none";
    }
  };

  gameArea.appendChild(el);

  let pos = 0;
  let fall = setInterval(() => {
    pos += 3;
    el.style.top = pos + "px";

    if (pos > 420) {
      clearInterval(fall);
      el.remove();
    }
  }, 25);
}

function selesaiMiniGame() {
  point = miniScore;

  document.getElementById("miniGameScreen").style.display = "none";
  document.getElementById("quizScreen").style.display = "block";

  soal = soalBank.sort(() => Math.random() - 0.5).slice(0, 15);
  i = 0;

  loadSoal();
}
</script>

</body>
</html>
